{"version":3,"sources":["index.tsx"],"names":["React","useState","useEffect","MaterialCommunityIcon","View","StyleSheet","stripe","Checkout","CheckoutController","useOrder","useSession","useApi","useLanguage","useUtils","useValidationFields","useConfig","OText","OButton","OIcon","IMAGES","colors","AddressDetails","PaymentOptions","DriverTips","OrderSummary","NotFoundSource","UserDetails","OrderTypeSelector","ChContainer","ChSection","ChHeader","ChTotal","ChAddress","ChMoment","CHMomentWrapper","ChPaymethods","ChDriverTips","ChCart","ChPlaceOrderBtn","ChErrors","ChBusinessDetails","ChUserDetails","Fade","Placeholder","PlaceholderLine","ToastType","useToast","Spinner","mapConfigs","mapZoom","mapSize","width","height","manageErrorsToShow","array","stringError","list","Array","isArray","Object","values","map","item","i","length","message","CheckoutUI","props","navigation","cart","errors","placing","cartState","businessDetails","paymethodSelected","handlePaymethodChange","handlerClickPlaceOrder","onNavigationRedirect","driverTipsOptions","showToast","t","user","configs","parsePrice","parseDate","options","carts","validationFields","errorCash","setErrorCash","userErrors","setUserErrors","isUserDetailsEdit","setIsUserDetailsEdit","phoneUpdate","setPhoneUpdate","configTypes","order_types_allowed","value","split","Number","cartsWithProducts","filter","products","handlePlaceOrder","Error","checkValidationFields","notFields","fields","checkout","field","required","includes","code","push","toUpperCase","name","cellphone","enabled","togglePhoneUpdate","val","errorText","total","paddingBottom","arrow_left","style","btnBackArrow","goBack","loading","status","textAlign","error","flexDirection","marginBottom","marginRight","marginTop","business","logo","marginLeft","paddSection","location","business_id","google_maps_api_key","paddSectionH","navigate","moment","outputFormat","format_time","email","address","id","paymethods","type","driver_tip","subtotal","minimum","secundary","primary","color","fontSize","valid","valid_address","valid_products","create","borderWidth","backgroundColor","borderColor","display","justifyContent","paddingLeft","padding","paddingHorizontal","clearErrors","cartUuid","stripePaymentOptions","token","ordering","orderState","confirmCart","setCartState","currentCart","setCurrentCart","getOrder","cartId","url","root","response","fetch","method","headers","Authorization","result","json","publicKey","content","setAccessToken","paymentCards","getCredentials","publishable","order","uuid","orderId","paymethod_data","gateway","confirmCartRes","isFromCheckout","toString","clientSecret","client_secret","paymentMethodId","data","source_id","setOptions","publishableKey","confirmPaymentIntent","e","cartMatched","find","checkoutProps","UIComponent","businessId"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport MaterialCommunityIcon from 'react-native-vector-icons/MaterialCommunityIcons';\r\nimport { View, StyleSheet } from 'react-native';\r\nimport stripe from 'tipsi-stripe';\r\n\r\nimport {\r\n  Checkout as CheckoutController,\r\n  useOrder,\r\n  useSession,\r\n  useApi,\r\n  useLanguage,\r\n  useUtils,\r\n  useValidationFields,\r\n  useConfig\r\n} from 'ordering-components/native';\r\n\r\nimport { OText, OButton, OIcon } from '../shared';\r\nimport { IMAGES } from '../../config/constants';\r\nimport { colors } from '../../theme';\r\n\r\nimport { AddressDetails } from '../AddressDetails';\r\nimport { PaymentOptions } from '../PaymentOptions';\r\nimport { DriverTips } from '../DriverTips';\r\nimport { OrderSummary } from '../OrderSummary';\r\nimport { NotFoundSource } from '../NotFoundSource';\r\nimport { UserDetails } from '../UserDetails';\r\nimport { OrderTypeSelector } from '../OrderTypeSelector'\r\n\r\nimport {\r\n  ChContainer,\r\n  ChSection,\r\n  ChHeader,\r\n  ChTotal,\r\n  ChTotalWrap,\r\n  ChAddress,\r\n  ChMoment,\r\n  CHMomentWrapper,\r\n  ChPaymethods,\r\n  ChDriverTips,\r\n  ChCart,\r\n  ChPlaceOrderBtn,\r\n  ChErrors,\r\n  ChBusinessDetails,\r\n  ChUserDetails\r\n} from './styles';\r\nimport { Fade, Placeholder, PlaceholderLine } from 'rn-placeholder';\r\n\r\nimport { ToastType, useToast } from '../../providers/ToastProvider';\r\nimport Spinner from 'react-native-loading-spinner-overlay';\r\n\r\nconst mapConfigs = {\r\n  mapZoom: 16,\r\n  mapSize: {\r\n    width: 640,\r\n    height: 190\r\n  }\r\n};\r\n\r\nconst manageErrorsToShow = (array = []) => {\r\n  let stringError = ''\r\n  const list = Array.isArray(array) ? array : Object.values(array)\r\n  list.map((item: any, i: number) => {\r\n    stringError += (i + 1) === array.length ? `- ${item?.message || item}` : `- ${item?.message || item}\\n`\r\n  })\r\n  return stringError;\r\n}\r\n\r\nconst CheckoutUI = (props: any) => {\r\n  const {\r\n    navigation,\r\n    cart,\r\n    errors,\r\n    placing,\r\n    cartState,\r\n    businessDetails,\r\n    paymethodSelected,\r\n    handlePaymethodChange,\r\n    handlerClickPlaceOrder,\r\n    onNavigationRedirect,\r\n    driverTipsOptions\r\n  } = props\r\n\r\n  const { showToast } = useToast();\r\n  const [, t] = useLanguage();\r\n  const [{ user }] = useSession();\r\n  const [{ configs }] = useConfig();\r\n  const [{ parsePrice, parseDate }] = useUtils();\r\n  const [{ options, carts }] = useOrder();\r\n  const [validationFields] = useValidationFields();\r\n\r\n  const [errorCash, setErrorCash] = useState(false);\r\n  const [userErrors, setUserErrors] = useState<any>([]);\r\n  const [isUserDetailsEdit, setIsUserDetailsEdit] = useState(false);\r\n  const [phoneUpdate, setPhoneUpdate] = useState(false)\r\n\r\n  const configTypes = configs?.order_types_allowed?.value.split('|').map((value: any) => Number(value)) || []\r\n\r\n  const cartsWithProducts = carts && Object.values(carts).filter((cart: any) => cart.products.length) || null\r\n\r\n  const handlePlaceOrder = () => {\r\n    if (!userErrors.length) {\r\n      handlerClickPlaceOrder && handlerClickPlaceOrder()\r\n      return\r\n    }\r\n    let stringError = ''\r\n    Object.values(userErrors).map((item: any, i: number) => {\r\n      stringError += (i + 1) === userErrors.length ? `- ${item?.message || item}` : `- ${item?.message || item}\\n`\r\n    })\r\n    showToast(ToastType.Error, stringError)\r\n    setIsUserDetailsEdit(true)\r\n  }\r\n\r\n  const checkValidationFields = () => {\r\n    setUserErrors([])\r\n    const errors = []\r\n    const notFields = ['coupon', 'driver_tip', 'mobile_phone', 'address', 'zipcode', 'address_notes']\r\n\r\n    Object.values(validationFields?.fields?.checkout).map((field: any) => {\r\n      if (field?.required && !notFields.includes(field.code)) {\r\n        if (!user[field?.code]) {\r\n          errors.push(t(`VALIDATION_ERROR_${field.code.toUpperCase()}_REQUIRED`, `The field ${field?.name} is required`))\r\n        }\r\n      }\r\n    })\r\n\r\n    if (\r\n      !user?.cellphone &&\r\n      validationFields?.fields?.checkout?.cellphone?.enabled &&\r\n      validationFields?.fields?.checkout?.cellphone?.required\r\n    ) {\r\n      errors.push(t('VALIDATION_ERROR_MOBILE_PHONE_REQUIRED', 'The field Phone number is required'))\r\n    }\r\n\r\n    if(phoneUpdate){\r\n      errors.push(t('NECESSARY_UPDATE_COUNTRY_PHONE_CODE', 'It is necessary to update your phone number'))\r\n    }\r\n\r\n    setUserErrors(errors)\r\n  }\r\n\r\n  const togglePhoneUpdate = (val: boolean) => {\r\n    setPhoneUpdate(val)\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (validationFields && validationFields?.fields?.checkout) {\r\n      checkValidationFields()\r\n    }\r\n  }, [validationFields, user])\r\n\r\n  useEffect(() => {\r\n    if (errors) {\r\n      const errorText = manageErrorsToShow(errors)\r\n      showToast(ToastType.Error, errorText)\r\n    }\r\n  }, [errors])\r\n\r\n  useEffect(() => {\r\n    handlePaymethodChange(null)\r\n  }, [cart?.total])\r\n\r\n  return (\r\n    <ChContainer>\r\n      <ChSection style={{  paddingBottom: 20 }}>\r\n        <OButton\r\n          imgLeftSrc={IMAGES.arrow_left}\r\n          imgRightSrc={null}\r\n          style={style.btnBackArrow}\r\n          onClick={() => navigation.goBack()}\r\n        />\r\n        <ChHeader>\r\n          <OText size={24}>{t('CHECKOUT', 'Checkout')}</OText>\r\n          <OrderTypeSelector configTypes={configTypes} />\r\n        </ChHeader>\r\n      </ChSection>\r\n\r\n      {!cartState.loading && (cart?.status === 2 || cart?.status === 4) && (\r\n        <ChSection style={{ paddingBottom: 20 }}>\r\n          <ChErrors>\r\n            {!cartState.loading && cart?.status === 2 && (\r\n              <OText\r\n                style={{ textAlign: 'center' }}\r\n                color={colors.error}\r\n                size={17}\r\n              >\r\n                {t('CART_STATUS_PENDING_MESSAGE_APP', 'Your order is being processed, please wait a little more. if you\\'ve been waiting too long, please reload the app')}\r\n              </OText>\r\n            )}\r\n            {!cartState.loading && cart?.status === 4 && (\r\n              <OText\r\n                style={{ textAlign: 'center' }}\r\n                color={colors.error}\r\n                size={17}\r\n              >\r\n                {t('CART_STATUS_CANCEL_MESSAGE', 'The payment has not been successful, please try again')}\r\n              </OText>\r\n            )}\r\n          </ChErrors>\r\n        </ChSection>\r\n      )}\r\n\r\n      <ChSection>\r\n        <ChTotal>\r\n          {\r\n            (businessDetails?.loading || cartState.loading) &&\r\n            !businessDetails?.error &&\r\n            (\r\n              <>\r\n                <Placeholder Animation={Fade}>\r\n                  <View style={{ flexDirection: 'row' }}>\r\n                    <PlaceholderLine width={25} height={70} style={{ marginBottom: 10, marginRight: 10 }} />\r\n                    <PlaceholderLine width={75} height={20} style={{ marginTop: 25 }} />\r\n                  </View>\r\n                </Placeholder>\r\n              </>\r\n            )}\r\n          {\r\n            !cartState.loading &&\r\n            !businessDetails?.loading &&\r\n            businessDetails?.business &&\r\n            Object.values(businessDetails?.business).length > 0 &&\r\n            (\r\n              <>\r\n                <OIcon\r\n                  url={businessDetails?.business?.logo}\r\n                  width={80}\r\n                  height={80}\r\n                  borderRadius={80}\r\n                />\r\n                <View style={{ marginLeft: 15 , width: '85%' }}>\r\n                  <OText size={22} numberOfLines={2} ellipsizeMode='tail' style={{ width: '85%' }}>\r\n                    {businessDetails?.business?.name}\r\n                  </OText>\r\n                  <OText size={22}>\r\n                    {cart?.total >= 1 && parsePrice(cart?.total)}\r\n                  </OText>\r\n                </View>\r\n              </>\r\n            )}\r\n        </ChTotal>\r\n      </ChSection>\r\n      <ChSection style={style.paddSection}>\r\n        <ChAddress>\r\n          {(businessDetails?.loading || cartState.loading) ? (\r\n            <Placeholder Animation={Fade}>\r\n              <PlaceholderLine height={20} style={{ marginBottom: 50 }} />\r\n              <PlaceholderLine height={100} />\r\n            </Placeholder>\r\n          ) : (\r\n            <AddressDetails\r\n              navigation={navigation}\r\n              location={businessDetails?.business?.location}\r\n              businessLogo={businessDetails?.business?.logo}\r\n              isCartPending={cart?.status === 2}\r\n              businessId={cart?.business_id}\r\n              apiKey={configs?.google_maps_api_key?.value}\r\n              mapConfigs={mapConfigs}\r\n            />\r\n          )}\r\n        </ChAddress>\r\n      </ChSection>\r\n      <ChSection style={style.paddSectionH}>\r\n        <ChMoment>\r\n          <CHMomentWrapper\r\n            onPress={() => navigation.navigate('MomentOption')}\r\n          >\r\n            <MaterialCommunityIcon\r\n              name='clock-outline'\r\n              size={24}\r\n              style={{ marginRight: 5 }}\r\n            />\r\n            <OText size={18} numberOfLines={1} ellipsizeMode='tail'>\r\n              {options?.moment\r\n                ? parseDate(options?.moment, {\r\n                  outputFormat: configs?.format_time?.value === '12' ? 'MM/DD hh:mma' : 'MM/DD HH:mm'\r\n                })\r\n                : t('ASAP_ABBREVIATION', 'ASAP')}\r\n            </OText>\r\n          </CHMomentWrapper>\r\n        </ChMoment>\r\n      </ChSection>\r\n\r\n      <ChSection style={style.paddSection}>\r\n        <ChUserDetails>\r\n          {cartState.loading ? (\r\n            <Placeholder Animation={Fade}>\r\n              <PlaceholderLine height={20} width={70} />\r\n              <PlaceholderLine height={15} width={60} />\r\n              <PlaceholderLine height={15} width={60} />\r\n              <PlaceholderLine height={15} width={80} style={{ marginBottom: 20 }} />\r\n            </Placeholder>\r\n          ) : (\r\n            <UserDetails\r\n              isUserDetailsEdit={isUserDetailsEdit}\r\n              cartStatus={cart?.status}\r\n              businessId={cart?.business_id}\r\n              useValidationFields\r\n              useDefualtSessionManager\r\n              useSessionUser\r\n              isCheckout\r\n              phoneUpdate={phoneUpdate}\r\n              togglePhoneUpdate={togglePhoneUpdate}\r\n            />\r\n          )}\r\n        </ChUserDetails>\r\n      </ChSection>\r\n\r\n      <ChSection style={style.paddSectionH}>\r\n        <ChBusinessDetails>\r\n          {\r\n            (businessDetails?.loading || cartState.loading) &&\r\n            !businessDetails?.error &&\r\n            (\r\n              <Placeholder Animation={Fade}>\r\n                <PlaceholderLine height={20} width={70} />\r\n                <PlaceholderLine height={15} width={60} />\r\n                <PlaceholderLine height={15} width={60} />\r\n                <PlaceholderLine height={15} width={80} style={{ marginBottom: 20 }} />\r\n              </Placeholder>\r\n            )}\r\n          {\r\n            !cartState.loading &&\r\n            businessDetails?.business &&\r\n            Object.values(businessDetails?.business).length > 0 &&\r\n            (\r\n              <View>\r\n                <OText size={20}>\r\n                  {t('BUSINESS_DETAILS', 'Business Details')}\r\n                </OText>\r\n                <View>\r\n                  <OText size={16}>\r\n                    <OText size={18} weight='bold'>\r\n                      {t('NAME', 'Name')}:{' '}\r\n                    </OText>\r\n                    {businessDetails?.business?.name}\r\n                  </OText>\r\n                  <OText size={16}>\r\n                    <OText size={18} weight='bold'>\r\n                      {t('EMAIL', 'Email')}:{' '}\r\n                    </OText>\r\n                    {businessDetails?.business?.email}\r\n                  </OText>\r\n                  <OText size={16}>\r\n                    <OText size={18} weight='bold'>\r\n                      {t('CELLPHONE', 'Cellphone')}:{' '}\r\n                    </OText>\r\n                    {businessDetails?.business?.cellphone}\r\n                  </OText>\r\n                  <OText size={16}>\r\n                    <OText size={18} weight='bold'>\r\n                      {t('ADDRESS', 'Address')}:{' '}\r\n                    </OText>\r\n                    {businessDetails?.business?.address}\r\n                  </OText>\r\n                </View>\r\n              </View>\r\n            )}\r\n          {businessDetails?.error && businessDetails?.error?.length > 0 && (\r\n            <View>\r\n              <OText size={20}>\r\n                {t('BUSINESS_DETAILS', 'Business Details')}\r\n              </OText>\r\n              <NotFoundSource\r\n                content={businessDetails?.error[0]?.message || businessDetails?.error[0]}\r\n              />\r\n            </View>\r\n          )}\r\n        </ChBusinessDetails>\r\n      </ChSection>\r\n\r\n      {!cartState.loading && cart && cart?.status !== 2 && (\r\n        <ChSection style={style.paddSection}>\r\n          <ChPaymethods>\r\n            <OText size={20}>\r\n              {t('PAYMENT_METHOD', 'Payment Method')}\r\n            </OText>\r\n            <PaymentOptions\r\n              cart={cart}\r\n              isDisabled={cart?.status === 2}\r\n              businessId={businessDetails?.business?.id}\r\n              isLoading={businessDetails.loading}\r\n              paymethods={businessDetails?.business?.paymethods}\r\n              onPaymentChange={handlePaymethodChange}\r\n              errorCash={errorCash}\r\n              setErrorCash={setErrorCash}\r\n              onNavigationRedirect={onNavigationRedirect}\r\n              isPaymethodNull={paymethodSelected}\r\n            />\r\n          </ChPaymethods>\r\n        </ChSection>\r\n      )}\r\n\r\n      {!cartState.loading &&\r\n        cart &&\r\n        options.type === 1 &&\r\n        cart?.status !== 2 &&\r\n        validationFields?.fields?.checkout?.driver_tip?.enabled &&\r\n        (\r\n          <ChSection style={style.paddSectionH}>\r\n            <ChDriverTips>\r\n              <OText size={20}>\r\n                {t('DRIVER_TIPS', 'Driver Tips')}\r\n              </OText>\r\n              <DriverTips\r\n                businessId={cart?.business_id}\r\n                driverTipsOptions={driverTipsOptions}\r\n                useOrderContext\r\n              />\r\n            </ChDriverTips>\r\n          </ChSection>\r\n        )}\r\n\r\n      {!cartState.loading && cart && (\r\n        <ChSection style={style.paddSection}>\r\n          <ChCart>\r\n            {cartsWithProducts && cart?.products?.length === 0 ? (\r\n              <NotFoundSource\r\n                content={t('NOT_FOUND_CARTS', 'Sorry, You don\\'t seem to have any carts.')}\r\n                btnTitle={t('SEARCH_REDIRECT', 'Go to Businesses')}\r\n              />\r\n            ) : (\r\n              <>\r\n                <OText size={20}>\r\n                  {t('ORDER_SUMMARY', 'Order Summary')}\r\n                </OText>\r\n                <OrderSummary\r\n                  cart={cart}\r\n                  isCartPending={cart?.status === 2}\r\n                />\r\n              </>\r\n            )}\r\n          </ChCart>\r\n        </ChSection>\r\n      )}\r\n\r\n      {!cartState.loading && cart && cart?.status !== 2 && (\r\n        <ChSection style={style.paddSectionH}>\r\n          <ChPlaceOrderBtn>\r\n            <OButton\r\n              onClick={() => handlePlaceOrder()}\r\n              bgColor={cart?.subtotal < cart?.minimum ? colors.secundary : colors.primary}\r\n              borderColor={colors.primary}\r\n              textStyle={{ color: 'white', fontSize: 20 }}\r\n              imgRightSrc={null}\r\n              // isLoading={formState.loading}\r\n              isDisabled={!cart?.valid || !paymethodSelected || placing || errorCash || cart?.subtotal < cart?.minimum}\r\n              text={cart?.subtotal >= cart?.minimum ? (\r\n                placing ? t('PLACING', 'Placing') : t('PLACE_ORDER', 'Place Order')\r\n              ) : (\r\n                `${t('MINIMUN_SUBTOTAL_ORDER', 'Minimum subtotal order:')} ${parsePrice(cart?.minimum)}`\r\n              )}\r\n            />\r\n          </ChPlaceOrderBtn>\r\n        </ChSection>\r\n      )}\r\n\r\n      {!cartState.loading && cart && (\r\n        <ChSection style={style.paddSection}>\r\n          <ChErrors>\r\n            {!cart?.valid_address && cart?.status !== 2 && (\r\n              <OText\r\n                style={{ textAlign: 'center' }}\r\n                color={colors.error}\r\n                size={14}\r\n              >\r\n                {t('INVALID_CART_ADDRESS', 'Selected address is invalid, please select a closer address.')}\r\n              </OText>\r\n            )}\r\n\r\n            {!paymethodSelected && cart?.status !== 2 && (\r\n              <OText\r\n                style={{ textAlign: 'center' }}\r\n                color={colors.error}\r\n                size={14}\r\n              >\r\n                {t('WARNING_NOT_PAYMENT_SELECTED', 'Please, select a payment method to place order.')}\r\n              </OText>\r\n            )}\r\n\r\n            {!cart?.valid_products && cart?.status !== 2 && (\r\n              <OText\r\n                style={{ textAlign: 'center' }}\r\n                color={colors.error}\r\n                size={14}\r\n              >\r\n                {t('WARNING_INVALID_PRODUCTS', 'Some products are invalid, please check them.')}\r\n              </OText>\r\n            )}\r\n          </ChErrors>\r\n        </ChSection>\r\n      )}\r\n    </ChContainer>\r\n  )\r\n}\r\n\r\nconst style = StyleSheet.create({\r\n  btnBackArrow: {\r\n    borderWidth: 0,\r\n    backgroundColor: '#FFF',\r\n    borderColor: '#FFF',\r\n    display: 'flex',\r\n    justifyContent: 'flex-start',\r\n    paddingLeft: 0,\r\n    width: 20\r\n  },\r\n  paddSection: {\r\n    padding: 20\r\n  },\r\n  paddSectionH: {\r\n    paddingHorizontal: 20\r\n  }\r\n})\r\n\r\nexport const Checkout = (props: any) => {\r\n  const {\r\n    errors,\r\n    clearErrors,\r\n    cartUuid,\r\n    stripePaymentOptions,\r\n    onNavigationRedirect,\r\n  } = props\r\n\r\n  const { showToast } = useToast();\r\n  const [, t] = useLanguage();\r\n  const [{ token }] = useSession();\r\n  const [ordering] = useApi();\r\n  const [orderState, { confirmCart }] = useOrder();\r\n\r\n  const [cartState, setCartState] = useState<any>({ loading: true, error: [], cart: null });\r\n  const [currentCart, setCurrentCart] = useState({ business_id: null, products: null });\r\n\r\n  const getOrder = async (cartId: any) => {\r\n    try {\r\n      setCartState({ ...cartState, loading: true })\r\n      const url = `${ordering.root}/carts/${cartId}`\r\n      const response = await fetch(url, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          Authorization: `Bearer ${token}`\r\n        }\r\n      })\r\n      const { result } = await response.json();\r\n\r\n      let publicKey = null\r\n      try {\r\n        const { content } = await ordering.setAccessToken(token).paymentCards().getCredentials();\r\n        if (!content.error) {\r\n          publicKey = content.result.publishable;\r\n        }\r\n      } catch (error) {\r\n        publicKey = null\r\n      }\r\n\r\n      if (result.status === 1 && result.order?.uuid) {\r\n        onNavigationRedirect('OrderDetails', { orderId: result.order.uuid })\r\n        setCartState({ ...cartState, loading: false })\r\n      } else if (result.status === 2 && result.paymethod_data?.gateway === 'stripe_redirect') {\r\n        try {\r\n          const confirmCartRes = await confirmCart(cartUuid)\r\n          if (confirmCartRes.error) {\r\n            showToast(ToastType.Error, confirmCartRes.error.message)\r\n          }\r\n          if (confirmCartRes.result.order?.uuid) {\r\n            onNavigationRedirect('OrderDetails', { orderId: confirmCartRes.result.order.uuid, isFromCheckout: true })\r\n          }\r\n          setCartState({\r\n            ...cartState,\r\n            loading: false,\r\n            cart: result\r\n          })\r\n        } catch (error) {\r\n          showToast(ToastType.Error, error?.toString() || error.message)\r\n        }\r\n      } else if (result.status === 2 && stripePaymentOptions.includes(result.paymethod_data?.gateway)) {\r\n        const clientSecret = result.paymethod_data?.result?.client_secret\r\n        const paymentMethodId = result.paymethod_data?.data?.source_id;\r\n\r\n        stripe.setOptions({\r\n          publishableKey: publicKey,\r\n          // androidPayMode: 'test', // Android only\r\n        })\r\n\r\n        try {\r\n          const confirmPaymentIntent = await stripe.confirmPaymentIntent({\r\n            clientSecret,\r\n            paymentMethodId\r\n          });\r\n\r\n          if (confirmPaymentIntent?.status === 'succeeded') {\r\n            try {\r\n              const confirmCartRes = await confirmCart(cartUuid)\r\n              if (confirmCartRes.error) {\r\n                showToast(ToastType.Error, confirmCartRes.error.message)\r\n              }\r\n              if (confirmCartRes.result.order?.uuid) {\r\n                onNavigationRedirect('OrderDetails', { orderId: confirmCartRes.result.order.uuid, isFromCheckout: true })\r\n              }\r\n            } catch (error) {\r\n              showToast(ToastType.Error, error?.toString() || error.message)\r\n            }\r\n            setCartState({\r\n              ...cartState,\r\n              loading: false,\r\n              cart: result\r\n            })\r\n            return\r\n          }\r\n        } catch (error) {\r\n          const e = error.message === 'failed'\r\n            ? t('FAILED_PAYMENT', 'Failed payment')\r\n            : error?.toString() || error.message\r\n          if (e.includes('The provided PaymentMethod was previously used with a PaymentIntent')) {\r\n            showToast(ToastType.Error, t('CART_STATUS_CANCEL_MESSAGE', 'The payment has not been successful, please try again'))\r\n            try {\r\n              const confirmCartRes = await confirmCart(cartUuid)\r\n              if (confirmCartRes.error) {\r\n                showToast(ToastType.Error, confirmCartRes.error.message)\r\n              }\r\n              setCartState({\r\n                ...cartState,\r\n                loading: false,\r\n                cart: result\r\n              })\r\n            } catch (error) {\r\n              showToast(ToastType.Error, error?.toString() || error.message)\r\n            }\r\n            return\r\n          }\r\n          showToast(ToastType.Error, e)\r\n          const cart = Array.isArray(result) ? null : result\r\n          setCartState({\r\n            ...cartState,\r\n            loading: false,\r\n            cart,\r\n            error: cart ? null : result\r\n          })\r\n        }\r\n      } else {\r\n        const cart = Array.isArray(result) ? null : result\r\n        setCartState({\r\n          ...cartState,\r\n          loading: false,\r\n          cart,\r\n          error: cart ? null : result\r\n        })\r\n      }\r\n    } catch (e) {\r\n      setCartState({\r\n        ...cartState,\r\n        loading: false,\r\n        error: [e.toString()]\r\n      })\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (!orderState.loading && currentCart?.business_id) {\r\n      const cartMatched: any = Object.values(orderState.carts).find(\r\n        (cart: any) => cart.business_id === currentCart?.business_id\r\n      ) || {}\r\n      setCurrentCart(cartMatched)\r\n    }\r\n  }, [orderState.loading])\r\n\r\n  useEffect(() => {\r\n    if (errors) {\r\n      const errorText = manageErrorsToShow(errors)\r\n      showToast(ToastType.Error, errorText)\r\n      clearErrors && clearErrors()\r\n    }\r\n  }, [errors])\r\n\r\n  useEffect(() => {\r\n    if (token && cartUuid) {\r\n      getOrder(cartUuid)\r\n    }\r\n  }, [token, cartUuid])\r\n\r\n  const checkoutProps = {\r\n    ...props,\r\n    UIComponent: CheckoutUI,\r\n    cartState,\r\n    businessId: cartState.cart?.business_id\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {cartState.loading ? (\r\n        <Spinner visible={cartState.loading}/>\r\n      ) : (\r\n        <CheckoutController {...checkoutProps} />\r\n      )}\r\n    </>\r\n  )\r\n}\r\n"]}